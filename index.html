<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Aprovação v5.3 - Estratégico</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f7f7f8; --card-bg: #ffffff; --text-primary: #1c1c1e; --text-secondary: #6b6f78;
            --primary-color: #007aff; --primary-hover: #0056b3; --green-color: #34c759; --border-color: #e5e5e7;
            --shadow: 0 4px 15px rgba(0,0,0,0.06); --revisao-color: #ff9500; --error-color: #ff3b30;
            --shadow-btn: 0 2px 5px rgba(0, 122, 255, 0.2);
        }
        body.dark-mode {
            --bg-color: #000000; --card-bg: #1c1c1e; --text-primary: #ffffff; --text-secondary: #8e8e93;
            --border-color: #38383a;
        }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--bg-color); color: var(--text-primary);
            margin: 0; transition: background-color 0.3s, color 0.3s;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        .top-bar {
            width: 100%; height: 64px; background-color: var(--card-bg); padding: 0 30px;
            box-shadow: var(--shadow); display: flex; align-items: center; justify-content: space-between;
            position: fixed; top: 0; left: 0; z-index: 100; box-sizing: border-box; border-bottom: 1px solid var(--border-color);
        }
        .top-bar h1 { font-size: 1.5em; color: var(--text-primary); margin: 0; font-weight: 700; }
        .top-nav { display: flex; gap: 20px; align-items: center; }
        .nav-link {
            padding: 21px 5px; border-bottom: 2px solid transparent; font-weight: 600;
            color: var(--text-secondary); text-decoration: none; transition: color 0.2s, border-color 0.2s;
            cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.9em;
        }
        .nav-link svg { width: 18px; height: 18px; }
        .nav-link:hover { color: var(--primary-color); }
        .nav-link.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .page-body { display: flex; padding-top: 64px; }
        .sidebar {
            width: 320px; min-width: 320px; background-color: var(--card-bg); padding: 25px;
            height: calc(100vh - 64px); position: sticky; top: 64px;
            display: flex; flex-direction: column; overflow-y: auto; border-right: 1px solid var(--border-color);
        }
        .main-content { flex-grow: 1; padding: 25px; }
        .progress-container { text-align: center; margin-bottom: 25px; }
        .progress-circle { width: 140px; height: 140px; border-radius: 50%; background: conic-gradient(var(--primary-color) 0deg, var(--border-color) 0deg);
            display: flex; justify-content: center; align-items: center; margin: 0 auto 10px auto; transition: background 0.4s ease; }
        .progress-circle-inner { width: 110px; height: 110px; border-radius: 50%; background-color: var(--card-bg);
            display: flex; justify-content: center; align-items: center; font-size: 2em; font-weight: 700; transition: background-color 0.3s; }
        .sidebar-widget { margin-top: 30px; }
        .sidebar-widget h3 { margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; font-size: 1.1em; display: flex; align-items: center; gap: 8px; justify-content: space-between; }
        
        .calendar-nav button { background: none; border: none; cursor: pointer; color: var(--text-secondary); padding: 5px; }
        .calendar-nav button:hover { color: var(--primary-color); }
        #calendar-month-year { flex-grow: 1; text-align: center; }

        #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; margin-top: 10px; }
        .day-cell { position: relative; display: flex; align-items: center; justify-content: center; height: 32px; width: 32px; box-sizing: border-box; margin: auto; font-size: 0.9em; border-radius: 50%; }
        #calendar .day-name { font-weight: 600; color: var(--text-secondary); height: auto; }
        #calendar .today { background-color: var(--primary-color); color: white; font-weight: 700; }
        .content-dot { position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); width: 5px; height: 5px; border-radius: 50%; }
        .day-cell[title] { cursor: help; }


        .ai-tools button, .sidebar-button { display: block; width: 100%; text-align: center; background-color: var(--primary-color); color: white; border: none; padding: 12px; border-radius: 10px;
            margin-bottom: 8px; cursor: pointer; transition: all 0.2s ease; font-family: 'Inter', sans-serif; font-weight: 600; text-decoration: none; box-sizing: border-box; font-size: 0.9em; box-shadow: var(--shadow-btn); }
        .ai-tools button:hover, .sidebar-button:hover { background-color: var(--primary-hover); transform: translateY(-1px); }
        #errorLogInput, #aiTopicInput { width: 100%; box-sizing: border-box; border-radius: 10px; border: 1px solid var(--border-color); padding: 12px; font-family: 'Inter', sans-serif; margin-bottom: 8px; background-color: var(--bg-color); color: var(--text-primary); font-size: 0.9em;}
        #errorLogList { list-style: none; padding: 0; margin-top: 10px; max-height: 150px; overflow-y: auto; font-size: 0.9em; }
        #errorLogList li { padding: 8px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .error-actions button { background: none; border: none; color: var(--error-color); cursor: pointer; font-size: 1.1em; opacity: 0.7; }
        #clearErrorLogButton { background-color: #ffeaea; color: var(--error-color); box-shadow: none; }
        body.dark-mode #clearErrorLogButton { background-color: #4a2c2c; }
        .dark-mode-toggle { margin-top: auto; }
        .schedule-grid { display: grid; grid-template-columns: 1fr; gap: 25px; }
        .card { background-color: var(--card-bg); border-radius: 16px; box-shadow: var(--shadow); padding: 25px; transition: all 0.3s; border: 1px solid var(--border-color); }
        .card h2 { margin: 0 0 20px 0; font-size: 1.4em; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; display:flex; align-items:center; gap: 10px; font-weight: 600; }
        .task-list { list-style: none; padding: 0; }
        .task-item { display: flex; align-items: center; padding: 12px 5px; border-top: 1px solid var(--border-color); }
        .task-item.revisao { background-color: #fff9e6; border-left: 3px solid var(--revisao-color); padding-left: 10px; }
        body.dark-mode .task-item.revisao { background-color: #2c261a; }
        .task-item:first-child { border-top: none; }
        .task-item.done label { text-decoration: line-through; color: var(--text-secondary); }
        .task-item label { flex-grow: 1; font-weight: 500; }
        .task-links button { color: var(--text-secondary); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px; margin-left: 5px; transition: color 0.2s; } .task-links button.link-saved { color: var(--primary-color); }
        .instructions-content { line-height: 1.7; font-size: 1.0em; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 12px; max-width: 700px; width: 90%; max-height: 85vh; overflow-y: auto; position: relative; transform: scale(0.95); transition: transform 0.3s; }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        .modal-close { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary); }
        .modal-body { color: var(--text-primary); }
        .modal-body h3 { margin-top: 0; color: var(--text-primary); }
        .modal-body p, .modal-body li { white-space: pre-wrap; line-height: 1.6; }
        .loader { width: 50px; height: 50px; border: 5px solid var(--border-color); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #2c2c2e; color: white; padding: 15px 25px; border-radius: 12px; z-index: 1001; transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55); box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-weight: 500; }
        .toast.show { bottom: 40px; }
        .toast.error { background-color: var(--error-color); }
        #simulados-form { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 25px; align-items: flex-end; }
        #simulados-form input { padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-primary); }
        #simulados-form button { padding: 10px 20px; }
        #simulados-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        #simulados-table th, #simulados-table td { border-bottom: 1px solid var(--border-color); padding: 12px; text-align: center; }
        #simulados-table th { background-color: var(--bg-color); font-weight: 600; }
        #simulados-summary { margin-top: 20px; font-weight: 600; font-size: 1.1em; text-align: center; padding: 15px; background-color: var(--bg-color); border-radius: 12px; }
        
        #planner-settings { display: flex; gap: 20px; align-items: center; padding: 15px; background-color: #eef5ff; border-radius: 12px; margin-bottom: 25px; border: 1px solid #cce0ff; }
        body.dark-mode #planner-settings { background-color: #2c2c2f; border-color: #444; }
        #planner-settings label { font-weight: 600; }
        #planner-settings input { width: 80px; padding: 8px; border-radius: 8px; border: 1px solid var(--border-color); text-align: center; font-size: 1em; font-weight: 600; background-color: var(--card-bg); color: var(--text-primary); }
        #planner-table { width: 100%; border-collapse: collapse; font-size: 0.95em; }
        #planner-table th, #planner-table td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        #planner-table th { font-weight: 600; color: var(--text-secondary); }
        #planner-table td input { width: 60px; text-align: center; padding: 6px; border-radius: 6px; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-primary);}
        .importance-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-badge { padding: 4px 10px; border-radius: 20px; font-weight: 600; font-size: 0.8em; color: white; }

        .task-item.simulado { background-color: #ffeaea; border-left: 3px solid var(--error-color); }
        body.dark-mode .task-item.simulado { background-color: #4a2c2c; }
        .task-item.descanso { background-color: #e6f7ec; border-left: 3px solid var(--green-color); }
        body.dark-mode .task-item.descanso { background-color: #1e3626; }
    </style>
</head>
<body>
    <header class="top-bar">
        <h1 id="main-title">Dashboard v5.3</h1>
        <nav class="top-nav">
            <a href="#" id="instrucoes-link" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Instruções</a>
            <a href="#" id="home-link" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>Plano de Estudos</a>
            <a href="#" id="planner-link" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>Planner Estratégico</a>
            <a href="#" id="simulados-link" class="nav-link"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>Simulados</a>
        </nav>
    </header>

    <div class="page-body">
        <aside class="sidebar">
            <div class="progress-container"><h3>Progresso (Fase 1)</h3><div class="progress-circle" id="progressCircle"><div class="progress-circle-inner" id="progressText">0%</div></div></div>
            <div class="sidebar-widget">
                <h3 class="calendar-nav">
                    <button id="prev-month-btn">‹</button>
                    <span id="calendar-month-year">Carregando...</span>
                    <button id="next-month-btn">›</button>
                </h3>
                <div id="calendar"></div>
            </div>
            <div class="sidebar-widget ai-tools"><h3><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg> IA Otimizada</h3><textarea id="aiTopicInput" rows="2" placeholder="Digite o tema para a IA..."></textarea><button id="ai-explain">Explique (Avançado)</button><button id="ai-questions">Gerar Questões Difíceis</button><button id="ai-diff">Diagnóstico Diferencial</button></div>
            <div class="sidebar-widget"><h3><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Registro Rápido de Erros</h3><textarea id="errorLogInput" rows="3" placeholder="Digite o conceito que você errou..."></textarea><button id="saveErrorButton" class="sidebar-button">Salvar Erro</button><ul id="errorLogList"></ul><button id="clearErrorLogButton" class="sidebar-button">Limpar Erros</button></div>
            <div class="dark-mode-toggle"><button id="darkModeButton" class="sidebar-button">🌙 Modo Noturno</button></div>
        </aside>

        <main id="instrucoes-view" class="main-content"><div class="card"><h2>ℹ️ Como Usar Este Dashboard v5.3</h2><div class="instructions-content"><h3>Bem-vindo à sua nova central de comando para a aprovação!</h3><p>Este dashboard foi desenhado para ser intuitivo, mas aqui estão os pontos-chave para extrair o máximo dele:</p><h4>1. Navegação Principal</h4><p>Use os links na barra superior para alternar entre as quatro seções principais: <strong>Instruções</strong>, seu <strong>Plano de Estudos</strong>, o <strong>Planner Estratégico</strong> e a análise de <strong>Simulados</strong>.</p><h4>2. O Plano de Estudos (Sua Base)</h4><p>É aqui que você acompanha seu progresso diário. Marque as tarefas como concluídas e veja a barra de progresso na lateral avançar. Use os ícones 📝 e 📺 para salvar e acessar rapidamente links para seus materiais de estudo.</p><h4>3. O Planner Estratégico (Seu GPS)</h4><p>Defina sua <strong>meta de acertos global</strong> e depois insira seu <strong>desempenho atual</strong> em cada grande área. O sistema irá te mostrar visualmente onde você está bem e onde precisa focar mais. Use-o para direcionar seus estudos de forma inteligente.</p><h4>4. Análise de Simulados (A Hora da Verdade)</h4><p>Registre cada simulado que fizer. Acompanhe sua performance geral e a média dos últimos 5 para ter uma visão clara da sua evolução. Ser honesto aqui é crucial.</p><h4>5. Ferramentas da Barra Lateral</h4><ul><li><strong>Progresso:</strong> Uma visão rápida de quão longe você já chegou na Fase 1.</li><li><strong>Agenda de Conteúdos:</strong> Veja rapidamente os tópicos da semana no calendário. A semana atual é destacada.</li><li><strong>IA Otimizada:</strong> Sua maior aliada. Digite um tema e peça explicações, questões ou diagnósticos diferenciais.</li><li><strong>Registro de Erros:</strong> A ferramenta mais importante. Errou uma questão? Anote o conceito aqui IMEDIATAMENTE. Revise esta lista com frequência.</li></ul></div></div></main>
        
        <main id="home-view" class="main-content" style="display: none;">
            <div class="schedule-grid">
                <div class="card"><h2>🩺 Clínica Médica (Outubro)</h2><ul class="task-list">
                    <li class="task-item" data-task-id="cm1"><input type="checkbox"><label>CONTEÚDO NOVO: HAS & IAM (Semana 1)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="cm1r"><input type="checkbox"><label>REVISÃO SEMANAL: HAS & IAM</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="cm2"><input type="checkbox"><label>CONTEÚDO NOVO: ICC & Asma/DPOC (Semana 2)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="cm2r"><input type="checkbox"><label>REVISÃO SEMANAL: ICC & Asma/DPOC</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                </ul></div>
                <div class="card"><h2>🔪 Cirurgia Geral (Novembro)</h2><ul class="task-list">
                    <li class="task-item revisao" data-task-id="cgr1"><input type="checkbox"><label>CHECKPOINT: Revisão Acumulada de Clínica Médica</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="cg1"><input type="checkbox"><label>CONTEÚDO NOVO: ATLS & Apendicite/Colecistite (Semana 3)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="cg1r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 3</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="cg2"><input type="checkbox"><label>CONTEÚDO NOVO: Pancreatite & Abdome Agudo Obstrutivo (Semana 4)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="cg2r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 4</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                </ul></div>
                <div class="card"><h2>🤰 Gineco-Obstetrícia (Novembro)</h2><ul class="task-list">
                     <li class="task-item revisao" data-task-id="gor1"><input type="checkbox"><label>CHECKPOINT: Revisão Acumulada de Clínica + Cirurgia</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="go1"><input type="checkbox"><label>CONTEÚDO NOVO: Pré-Natal & Síndromes Hipertensivas (Semana 5)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="go1r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 5</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="go2"><input type="checkbox"><label>CONTEÚDO NOVO: Rastreamento Ginecológico & Anticoncepção (Semana 6)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="go2r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 6</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                </ul></div>
                <div class="card"><h2>👶 Pediatria (Dezembro)</h2><ul class="task-list">
                    <li class="task-item revisao" data-task-id="pedr1"><input type="checkbox"><label>CHECKPOINT: Revisão Acumulada de Clínica + Cirurgia + G.O.</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="ped1"><input type="checkbox"><label>CONTEÚDO NOVO: Calendário Vacinal, Reanimação Neo & Icterícia (Semana 7)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="ped1r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 7</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="ped2"><input type="checkbox"><label>CONTEÚDO NOVO: GECA/Desidratação & Crise Asmática Infantil (Semana 8)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="ped2r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 8</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                </ul></div>
                <div class="card"><h2>📊 Preventiva & Finalização (Dezembro)</h2><ul class="task-list">
                    <li class="task-item revisao" data-task-id="prer1"><input type="checkbox"><label>CHECKPOINT: Revisão Acumulada de TODAS as 4 grandes áreas</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item" data-task-id="pre1"><input type="checkbox"><label>CONTEÚDO NOVO: Leis do SUS & Estudos Epidemiológicos (Semana 9)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button><button title="Vídeo" class="link-button" data-link-type="video">📺</button></div></li>
                    <li class="task-item revisao" data-task-id="pre1r"><input type="checkbox"><label>REVISÃO SEMANAL: Temas da Semana 9</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item simulado" data-task-id="sim1"><input type="checkbox"><label>SIMULADO FINAL FASE 1 (50 questões)</label><div class="task-links"><button title="Anotações / Link Doc" class="link-button" data-link-type="doc">📝</button></div></li>
                    <li class="task-item descanso" data-task-id="fim1"><input type="checkbox"><label>DESCANSAR E RECARREGAR PARA A FASE 2!</label><div class="task-links"></div></li>
                </ul></div>
            </div>
        </main>

        <main id="simulados-view" class="main-content" style="display: none;"><div class="card"><h2>🎯 Simulados & Análise de Performance</h2><form id="simulados-form"><label for="simulado-date">Data:</label><input type="date" id="simulado-date" required><label for="simulado-total">Total Q.:</label><input type="number" id="simulado-total" min="1" value="100" required><label for="simulado-correct">Acertos:</label><input type="number" id="simulado-correct" min="0" required><button class="sidebar-button" type="submit">Adicionar</button></form><div id="simulados-summary">Calculando performance...</div><table id="simulados-table"><thead><tr><th>Data</th><th>Acertos</th><th>Total</th><th>%</th><th>Ações</th></tr></thead><tbody id="simulados-list"></tbody></table></div></main>

        <main id="planner-view" class="main-content" style="display: none;">
             <div class="card">
                <h2>🎯 Planner Estratégico de Performance</h2>
                <div id="planner-settings">
                    <label for="global-target">Sua Meta de Acertos Global (%):</label>
                    <input type="number" id="global-target" value="80" min="1" max="100">
                </div>
                <table id="planner-table">
                    <thead><tr><th>Grande Área</th><th>Importância</th><th>Nº Questões (Sugestão)</th><th>Meu Desempenho Atual (%)</th><th>Status</th></tr></thead>
                    <tbody>
                        <tr data-area="clinica"><td>Clínica Médica</td><td><span class="importance-dot" style="background-color: #ff3b30;"></span>Alta</td><td>1200</td><td><input type="number" class="performance-input" value="65" min="0" max="100"></td><td><span class="status-badge"></span></td></tr>
                        <tr data-area="cirurgia"><td>Cirurgia Geral</td><td><span class="importance-dot" style="background-color: #ff3b30;"></span>Alta</td><td>900</td><td><input type="number" class="performance-input" value="70" min="0" max="100"></td><td><span class="status-badge"></span></td></tr>
                        <tr data-area="go"><td>Gineco-Obstetrícia</td><td><span class="importance-dot" style="background-color: #ff9500;"></span>Média</td><td>800</td><td><input type="number" class="performance-input" value="75" min="0" max="100"></td><td><span class="status-badge"></span></td></tr>
                        <tr data-area="pediatria"><td>Pediatria</td><td><span class="importance-dot" style="background-color: #ff9500;"></span>Média</td><td>800</td><td><input type="number" class="performance-input" value="80" min="0" max="100"></td><td><span class="status-badge"></span></td></tr>
                        <tr data-area="preventiva"><td>Medicina Preventiva</td><td><span class="importance-dot" style="background-color: #34c759;"></span>Baixa</td><td>600</td><td><input type="number" class="performance-input" value="85" min="0" max="100"></td><td><span class="status-badge"></span></td></tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <div id="ai-modal" class="modal-overlay"><div class="modal-content"><button id="ai-modal-close" class="modal-close">&times;</button><div class="modal-body"><h3 id="modal-title"></h3><div id="modal-loader" class="loader"></div><div id="modal-text-content" style="display: none; white-space: pre-wrap; line-height: 1.7;"></div></div></div></div>
    <div id="link-modal" class="modal-overlay"><div class="modal-content"><button id="link-modal-close" class="modal-close">&times;</button><div class="modal-body"><h3 id="link-title">Adicionar Link</h3><p id="link-task-name"></p><input type="url" id="link-input" placeholder="https://..."><div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;"><button class="sidebar-button" style="background-color: var(--text-secondary);" id="cancelLinkButton">Cancelar</button><button class="sidebar-button" id="saveLinkButton">Salvar Link</button></div></div></div></div>
    <div id="toast-notification" class="toast"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONSTANTES GLOBAIS ---
            const checkboxes = document.querySelectorAll('.task-item input[type="checkbox"]');
            const progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            const totalTasks = checkboxes.length;
            const errorLogInput = document.getElementById('errorLogInput');
            const saveErrorButton = document.getElementById('saveErrorButton');
            const errorLogList = document.getElementById('errorLogList');
            const clearErrorLogButton = document.getElementById('clearErrorLogButton');
            const darkModeButton = document.getElementById('darkModeButton');
            let currentCalendarDate = new Date();
            
            let errorLog = {}, taskLinks = {}, simulados = [], plannerData = {};
            let currentEditingLink = { id: null, type: null, label: null };

            // --- CONSTANTES DE NAVEGAÇÃO ---
            const navLinks = {
                instrucoes: document.getElementById('instrucoes-link'),
                home: document.getElementById('home-link'),
                planner: document.getElementById('planner-link'),
                simulados: document.getElementById('simulados-link')
            };
            const views = {
                instrucoes: document.getElementById('instrucoes-view'),
                home: document.getElementById('home-view'),
                planner: document.getElementById('planner-view'),
                simulados: document.getElementById('simulados-view')
            };
            const mainTitle = document.getElementById('main-title');
            const toast = document.getElementById('toast-notification');

            // --- FUNÇÃO DE NAVEGAÇÃO ---
            function showView(viewName) {
                Object.values(views).forEach(view => view.style.display = 'none');
                Object.values(navLinks).forEach(link => link.classList.remove('active'));
                
                views[viewName].style.display = 'block';
                navLinks[viewName].classList.add('active');

                const titles = {
                    instrucoes: "Instruções do Dashboard",
                    home: "Plano de Estudos - Fase 1",
                    planner: "Planner Estratégico",
                    simulados: "Simulados & Análise"
                };
                mainTitle.textContent = titles[viewName];
            }

            // --- FUNÇÃO DE FEEDBACK (TOAST) ---
            function showToast(message, isError = false) {
                toast.textContent = message;
                toast.className = 'toast show';
                if (isError) toast.classList.add('error');
                setTimeout(() => { toast.classList.remove('show'); }, 3000);
            }

            // --- FUNÇÕES DE ESTADO E PROGRESSO ---
            function updateProgress() {
                const checkedTasks = document.querySelectorAll('.task-item input[type="checkbox"]:checked').length;
                const percentage = totalTasks > 0 ? Math.round((checkedTasks / totalTasks) * 100) : 0;
                progressCircle.style.background = `conic-gradient(var(--primary-color) ${percentage * 3.6}deg, var(--border-color) ${percentage * 3.6}deg)`;
                progressText.textContent = `${percentage}%`;
            }

            function saveState() {
                localStorage.setItem('tasksState_v5.3', JSON.stringify(Array.from(checkboxes).map(cb => cb.checked)));
                localStorage.setItem('errorLog_v5.3', JSON.stringify(errorLog));
                localStorage.setItem('taskLinks_v5.3', JSON.stringify(taskLinks));
                localStorage.setItem('simulados_v5.3', JSON.stringify(simulados));
                localStorage.setItem('plannerData_v5.3', JSON.stringify(plannerData));
                localStorage.setItem('darkMode_v5.3', document.body.classList.contains('dark-mode'));
            }

            function loadState() {
                const savedTasks = JSON.parse(localStorage.getItem('tasksState_v5.3'));
                if (savedTasks) checkboxes.forEach((cb, i) => { cb.checked = savedTasks[i]; if(cb.checked) cb.closest('.task-item').classList.add('done'); });
                
                errorLog = JSON.parse(localStorage.getItem('errorLog_v5.3')) || {};
                taskLinks = JSON.parse(localStorage.getItem('taskLinks_v5.3')) || {};
                simulados = JSON.parse(localStorage.getItem('simulados_v5.3')) || [];
                plannerData = JSON.parse(localStorage.getItem('plannerData_v5.3')) || {};
                
                updateProgress();
                updateErrorListDisplay();
                updateAllLinkButtonDisplays();
                displaySimulados();
                loadPlannerData();
            }
            
            // --- FUNÇÕES DO WIDGET DE ERROS ---
            function saveError() {
                const errorText = errorLogInput.value.trim();
                if (errorText) {
                    const errorId = `err_${Date.now()}`;
                    errorLog[errorId] = { text: errorText };
                    errorLogInput.value = '';
                    updateErrorListDisplay();
                    saveState();
                    showToast('Erro salvo com sucesso!');
                }
            }
            function updateErrorListDisplay() {
                errorLogList.innerHTML = '';
                Object.keys(errorLog).forEach(id => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${errorLog[id].text}</span><button class="error-actions" data-id="${id}">❌</button>`;
                    li.querySelector('button').onclick = () => deleteError(id);
                    errorLogList.appendChild(li);
                });
            }
            function deleteError(id) {
                if (confirm(`Remover o erro: "${errorLog[id].text}"?`)) {
                    delete errorLog[id];
                    updateErrorListDisplay();
                    saveState();
                }
            }
            function clearErrorLog() {
                if (confirm('Limpar TODOS os erros?')) {
                    errorLog = {};
                    updateErrorListDisplay();
                    saveState();
                }
            }

            // --- LÓGICA DO PLANNER ESTRATÉGICO ---
            const globalTargetInput = document.getElementById('global-target');
            const performanceInputs = document.querySelectorAll('.performance-input');
            function updatePlannerStatus() {
                const globalTarget = parseInt(globalTargetInput.value) || 0;
                document.querySelectorAll('#planner-table tbody tr').forEach(row => {
                    const performance = parseInt(row.querySelector('.performance-input').value) || 0;
                    const statusBadge = row.querySelector('.status-badge');
                    let text = 'Abaixo da Meta', color = 'var(--error-color)';
                    if (performance >= globalTarget) { text = 'Acima da Meta'; color = 'var(--green-color)'; }
                    else if (performance >= globalTarget - 5) { text = 'Na Meta'; color = '#ffcc00'; }
                    statusBadge.textContent = text;
                    statusBadge.style.backgroundColor = color;
                    const area = row.dataset.area;
                    if(area) plannerData[area] = performance;
                });
                plannerData.globalTarget = globalTarget;
                saveState();
            }
            function loadPlannerData() {
                globalTargetInput.value = plannerData.globalTarget || 80;
                document.querySelectorAll('#planner-table tbody tr').forEach(row => {
                    const area = row.dataset.area;
                    if(area && plannerData[area] !== undefined) row.querySelector('.performance-input').value = plannerData[area];
                });
                updatePlannerStatus();
            }

            // --- FUNÇÕES DA ABA SIMULADOS ---
            const simuladosForm = document.getElementById('simulados-form');
            const simuladosList = document.getElementById('simulados-list');
            const simuladosSummary = document.getElementById('simulados-summary');
            simuladosForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const date = document.getElementById('simulado-date').value;
                const total = parseInt(document.getElementById('simulado-total').value);
                const correct = parseInt(document.getElementById('simulado-correct').value);
                if (date && total > 0 && correct >= 0 && correct <= total) {
                    const newSimulado = { id: `sim_${Date.now()}`, date, correct, total };
                    simulados.unshift(newSimulado);
                    simulados.sort((a,b) => new Date(b.date) - new Date(a.date));
                    saveState();
                    displaySimulados();
                    simuladosForm.reset();
                    showToast('Simulado adicionado!');
                } else {
                    showToast('Dados inválidos.', true);
                }
            });
            function displaySimulados() {
                simuladosList.innerHTML = '';
                if (simulados.length === 0) {
                    simuladosList.innerHTML = '<tr><td colspan="5">Nenhum simulado registrado.</td></tr>';
                    simuladosSummary.textContent = "Registre seu 1º simulado!";
                    return;
                }
                let totalCorrect = 0, totalQuestions = 0, last5Correct = 0, last5Total = 0;
                simulados.forEach((sim, index) => {
                    const percentage = ((sim.correct / sim.total) * 100).toFixed(1);
                    const row = simuladosList.insertRow();
                    row.innerHTML = `<td>${new Date(sim.date+'T00:00:00').toLocaleDateString('pt-BR')}</td><td>${sim.correct}</td><td>${sim.total}</td><td>${percentage}%</td><td><button class="error-actions" data-id="${sim.id}">❌</button></td>`;
                    row.querySelector('button').onclick = () => deleteSimulado(sim.id);
                    totalCorrect += sim.correct;
                    totalQuestions += sim.total;
                    if (index < 5) {
                        last5Correct += sim.correct;
                        last5Total += sim.total;
                    }
                });
                const overallPercentage = totalQuestions > 0 ? ((totalCorrect / totalQuestions) * 100).toFixed(1) : 0;
                const last5Percentage = last5Total > 0 ? ((last5Correct / last5Total) * 100).toFixed(1) : 0;
                simuladosSummary.textContent = `Performance Geral: ${overallPercentage}% | Média Últimos 5: ${last5Percentage}%`;
            }
            function deleteSimulado(id) {
                if (confirm('Remover este resultado de simulado?')) {
                    simulados = simulados.filter(sim => sim.id !== id);
                    saveState();
                    displaySimulados();
                }
            }

            // --- FUNÇÕES DE LINKS E MODAIS ---
            const linkModal = document.getElementById('link-modal');
            const aiModal = document.getElementById('ai-modal');
            function openModal(modalId) { document.getElementById(modalId).classList.add('visible'); }
            function closeModal(modalId) { document.getElementById(modalId).classList.remove('visible'); }

            document.querySelectorAll('.link-button').forEach(button => button.addEventListener('click', (e) => handleLinkClick(e.target)));
            function handleLinkClick(button) {
                const taskItem = button.closest('.task-item');
                const taskId = taskItem.dataset.taskId;
                const linkType = button.dataset.linkType;
                const linkId = `${taskId}_${linkType}`;
                const savedLink = taskLinks[linkId];
                if (savedLink) {
                    window.open(savedLink, '_blank');
                } else {
                    currentEditingLink = { id: linkId, label: taskItem.querySelector('label').textContent };
                    document.getElementById('link-task-name').textContent = currentEditingLink.label;
                    document.getElementById('link-input').value = '';
                    openModal('link-modal');
                }
            }
            document.getElementById('saveLinkButton').addEventListener('click', () => {
                const url = document.getElementById('link-input').value.trim();
                if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
                    taskLinks[currentEditingLink.id] = url;
                    saveState();
                    updateAllLinkButtonDisplays();
                    closeModal('link-modal');
                    showToast('Link salvo!');
                } else {
                    showToast('URL inválida.', true);
                }
            });
            function updateAllLinkButtonDisplays() {
                document.querySelectorAll('.link-button').forEach(button => {
                    const linkId = `${button.closest('.task-item').dataset.taskId}_${button.dataset.linkType}`;
                    button.classList.toggle('link-saved', !!taskLinks[linkId]);
                });
            }
            document.getElementById('link-modal-close').onclick = () => closeModal('link-modal');
            document.getElementById('cancelLinkButton').onclick = () => closeModal('link-modal');
            document.getElementById('ai-modal-close').onclick = () => closeModal('ai-modal');

            // --- FUNÇÕES DO WIDGET DE IA (GEMINI API) ---
            async function callGemini(action) {
                const topic = document.getElementById('aiTopicInput').value.trim();
                if (!topic) { showToast('Digite um tema para a IA.', true); return; }
                
                const prompts = {
                    explain_deep: `Você é um especialista e preceptor de residência médica. Explique o tópico "${topic}" de forma aprofundada, com foco em fisiopatologia, quadro clínico, diagnóstico (padrão-ouro e alternativas) e tratamento de primeira linha para provas. Use **negrito** para termos-chave e listas para organizar.`,
                    questions_hard: `Crie 2 questões de múltipla escolha (A, B, C, D, E), **bem difíceis**, estilo prova de residência (cenário clínico complexo), sobre "${topic}". Forneça o gabarito e uma explicação detalhada para cada uma, justificando a alternativa correta e o porquê das erradas.`,
                    diff_diag: `Liste os principais diagnósticos diferenciais para um quadro clínico de "${topic}". Para cada diferencial, aponte achados-chave que ajudariam a distingui-lo.`
                };
                const titles = { explain_deep: `Explicação Avançada: ${topic}`, questions_hard: `Questões Difíceis: ${topic}`, diff_diag: `Diagnósticos Diferenciais: ${topic}` };

                document.getElementById('modal-title').textContent = titles[action];
                document.getElementById('modal-text-content').style.display = 'none';
                document.getElementById('modal-loader').style.display = 'block';
                openModal('ai-modal');

                const apiKey = ""; // Será injetada pelo ambiente
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompts[action] }] }] })
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) {
                        document.getElementById('modal-text-content').innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
                    } else { throw new Error('Resposta da API vazia.'); }
                } catch (error) {
                    console.error("Erro na API Gemini:", error);
                    document.getElementById('modal-text-content').innerHTML = `<p style="color:var(--error-color)">Ocorreu um erro. Tente novamente.</p>`;
                } finally {
                    document.getElementById('modal-loader').style.display = 'none';
                    document.getElementById('modal-text-content').style.display = 'block';
                }
            }
            document.getElementById('ai-explain').onclick = () => callGemini('explain_deep');
            document.getElementById('ai-questions').onclick = () => callGemini('questions_hard');
            document.getElementById('ai-diff').onclick = () => callGemini('diff_diag');

            // --- FUNÇÕES DE CALENDÁRIO E TEMA ---
            function generateCalendar(date) {
                const calendarEl = document.getElementById('calendar'), monthYearEl = document.getElementById('calendar-month-year');
                
                const schedule = [
                    { start: '2025-10-20', end: '2025-10-26', subject: 'Clínica Médica', topics: 'HAS & IAM', color: 'var(--primary-color)' },
                    { start: '2025-10-27', end: '2025-11-02', subject: 'Clínica Médica', topics: 'ICC & Asma/DPOC', color: 'var(--primary-color)' },
                    { start: '2025-11-03', end: '2025-11-09', subject: 'Cirurgia Geral', topics: 'ATLS & Apendicite', color: '#ff3b30' },
                    { start: '2025-11-10', end: '2025-11-16', subject: 'Cirurgia Geral', topics: 'Pancreatite & Abdome Agudo', color: '#ff3b30' },
                    { start: '2025-11-17', end: '2025-11-23', subject: 'G.O.', topics: 'Pré-Natal & S. Hipertensivas', color: '#ff9500' },
                    { start: '2025-11-24', end: '2025-11-30', subject: 'G.O.', topics: 'Rastreamento & Anticoncepção', color: '#ff9500' },
                    { start: '2025-12-01', end: '2025-12-07', subject: 'Pediatria', topics: 'Vacinas, Reanimação Neo', color: '#34c759' },
                    { start: '2025-12-08', end: '2025-12-14', subject: 'Pediatria', topics: 'GECA & Crise Asmática', color: '#34c759' },
                    { start: '2025-12-15', end: '2025-12-21', subject: 'Preventiva', topics: 'Leis do SUS & Estudos', color: '#5856d6' }
                ];

                const month = date.getMonth(), year = date.getFullYear();
                monthYearEl.textContent = `${date.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}`;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                calendarEl.innerHTML = '';
                ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].forEach(day => calendarEl.innerHTML += `<div class="day-name day-cell">${day}</div>`);
                for (let i = 0; i < firstDay; i++) calendarEl.appendChild(document.createElement('div')).classList.add('day-cell');

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('day-cell');
                    dayEl.textContent = day;

                    const currentDate = new Date(year, month, day);
                    const todayDate = new Date();
                    if (day === todayDate.getDate() && month === todayDate.getMonth() && year === todayDate.getFullYear()) {
                        dayEl.classList.add('today');
                    }
                    
                    for(const item of schedule) {
                        const startDate = new Date(item.start + 'T00:00:00');
                        const endDate = new Date(item.end + 'T23:59:59');
                        if (currentDate >= startDate && currentDate <= endDate) {
                            dayEl.title = `${item.subject}: ${item.topics}`;
                            const dot = document.createElement('div');
                            dot.className = 'content-dot';
                            dot.style.backgroundColor = item.color;
                            dayEl.appendChild(dot);
                            break;
                        }
                    }
                    calendarEl.appendChild(dayEl);
                }
            }

            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                saveState();
                darkModeButton.textContent = document.body.classList.contains('dark-mode') ? '☀️ Modo Claro' : '🌙 Modo Noturno';
            }
            function loadTheme() {
                if (localStorage.getItem('darkMode_v5.3') === 'true') {
                    document.body.classList.add('dark-mode');
                    darkModeButton.textContent = '☀️ Modo Claro';
                }
            }
            
            // --- INICIALIZAÇÃO GERAL ---
            currentCalendarDate.setFullYear(2025); // Fixar ano em 2025 para demonstração
            currentCalendarDate.setMonth(9); // Começar em Outubro

            Object.keys(navLinks).forEach(key => navLinks[key].addEventListener('click', (e) => { e.preventDefault(); showView(key); }));
            checkboxes.forEach(cb => cb.addEventListener('change', () => { cb.closest('.task-item').classList.toggle('done', cb.checked); updateProgress(); saveState(); }));
            saveErrorButton.addEventListener('click', saveError);
            clearErrorLogButton.addEventListener('click', clearErrorLog);
            globalTargetInput.addEventListener('input', updatePlannerStatus);
            performanceInputs.forEach(input => input.addEventListener('input', updatePlannerStatus));
            darkModeButton.addEventListener('click', toggleDarkMode);
            document.getElementById('prev-month-btn').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
                generateCalendar(currentCalendarDate);
            });
            document.getElementById('next-month-btn').addEventListener('click', () => {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
                generateCalendar(currentCalendarDate);
            });

            generateCalendar(currentCalendarDate);
            loadState();
            loadTheme();
            showView('instrucoes');
        });
    </script>
</body>
</html>


